<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <script type="application/javascript">
    function draw() {
      var canvas = document.getElementById("canvas");
      if (canvas.getContext) {
        var ctx = canvas.getContext("2d");
          
        ctx.fillStyle = "rgb(162,115,164)";
       ctx.fillRect (0, 0, 320, 320);
      }
          
                var map = [];
                  for (var x = 0; x < 10; x++) {
                        map[x] = [];
        for (var y = 0; y < 10; y++) 
                map[x][y] = {'x':x, 'y':y, 'wall':0};                      
            }

    
              for(var licznik=0; licznik<=15; licznik++)
                    {
                      
          var x = Math.floor(((Math.random() * 319) + 0)/32);
          var y = Math.floor(((Math.random() * 319) + 0)/32); 
                        
                     
           ctx.fillStyle = "rgb(0,0,0)";
        ctx.fillRect (x*32, y*32, 32, 32);
                         map[x][y] = {'x':x, 'y':y, 'wall':1};
                            

                    }
            //  console.log(map[x][y]);
              var start = {};
              while(map[x][y].wall==1)
                  {
        x = Math.floor(((Math.random() * 319) + 0)/32);
        y = Math.floor(((Math.random() * 319) + 0)/32); 
                      start.x=x;
                      start.y=y;
                    start.wall=2;
                  }
              ctx.fillStyle = "rgb(230,255,0)";
              ctx.fillRect (x*32, y*32, 32, 32);
             map[x][y] = {'x':start.x, 'y':start.y, 'wall':2};
              
              var end = {};
              end.x = 1;
              end.y = 1;
                ctx.fillStyle = "rgb(51,0,255)";
              ctx.fillRect (end.x*32, end.y*32, 32, 32);
             map[x][y] = {'x':end.x, 'y':end.y, 'wall':3};
              
         pathFinding(map, start, end);
              
          }
      
          function heuristic(pos0, pos1) {
        var dlX = Math.abs(pos1.x - pos0.x);
        var dlY = Math.abs(pos1.y - pos0.y);
     var length = Math.floor(Math.sqrt((dlX * dlX) + (dlY * dlY)));
        return length;      
      
          }
      
      
    function neighbors(map, node) {
        
        var position = [];
    var x = node.x;
    var y = node.y;
  //  var g = node.g;
    
        if(x-1>=0){
             if(map[x-1][y].wall!=1 )
                 {
            
         //map[x-1][y].g = map[x][y].g + 1; 
        position.push(map[x - 1][y]);
                     
                 }
        }
        if(x+1<=9){
        if (map[x+1][y].wall!=1 ) {
            
            //map[x+1][y].g = map[x][y].g + 1; 
            position.push(map[x + 1][y]);
        }
        }
        if(y-1>=0){
        if (map[x][y-1].wall!=1 ) {
            
           // map[x][y-1].g = map[x][y].g + 1; 
            position.push(map[x][y - 1]);
        }
        }
        if(y+1<=9){
        if (map[x][y+1].wall!=1 ) {
            
         //   map[x][y+1].g = map[x][y].g + 1;
            position.push(map[x][y + 1]);
        }
        }
       // console.log(position[2]);
        return position;
    }
      
      function pathFinding(map, start, end) {
          
         for(var x = 0; x<10; x++)
              {
                  for(var y = 0; y<10; y++)
                      {
                       map[x][y].g = 0;
                      // map[x][y].f=0;
                       map[x][y].h =0;
                     map[x][y].parent = null;
              }
      }
          
          
          
          var open = [];
          var closed = [];
          
             open.push(start);
          open[0].g = 0;
          //open[0].f = 0;
          //open[0].h=heuristic(start, end);
        //map[start.x][start.y].g = 0;
          
          
          while(open.length>0){
              var best = 0;
              console.log("ilosc w open ",open.length);
              for(var i=0; i<open.length; i++){
                  console.log("punkt:",open[i].x,",",open[i].y,", koszt f:", open[i].f);
                 if(!open[i].f)console.log("blad w: ",open[i].x,", ",open[i].y);
                  console.log("----------");
              	if(open[i].f <= open[best].f) { 

                        best = i; 
                }
                  
              }
              //console.log("koniec petli");
              //console.log(open[best].f);
              console.log("--------------------------------------------------");
			var currentNode = open[best];
              open[best].f=9999;

                   
                              
                		if((currentNode.x === end.x) && (currentNode.y === end.y)) {
				var curr = currentNode;
                console.log("kupa");
				var path = [];
				while(curr.parent) {
					path.push(curr);
					curr = curr.parent;
                   // console.log("end");
				}
                      var ctx = canvas.getContext("2d");
                                
                   ctx.fillStyle = "rgb(175,238,238)";
                            for(var i=1; i<path.length; i++){
                   ctx.fillRect (path[i].x*32, path[i].y*32, 32, 32);         
                        }
                            return 0;
			}
          
                //console.log(open.length);
                console.log("wybrano:",currentNode.x,",",currentNode.y);

                closed.push(currentNode);
          var getneighbors = neighbors(map, currentNode);
                //console.log("sasiedi");
                //console.log(getneighbors.length);

          	for(var i=0; i<getneighbors.length; i++) {
                
				var neighbor = getneighbors[i];
				if(searchnode(closed, neighbor)) {
                    
				continue;
                    
				}
                
                 var gscore = currentNode.g+1;  
                //console.log(gscore);
                var bestscore = false;
                
                if(!searchnode(open, neighbor))
                {
                    
                    bestscore=true;
                    map[neighbor.x][neighbor.y].h = heuristic(neighbor, end);                        open.push(neighbor);

                }
              /*  else if(gscore < (map[neighbor.x][neighbor.y].g)) {
					
					bestscore = true;
                        }*/
                if(bestscore)
                    {
                 map[neighbor.x][neighbor.y].f = gscore + map[neighbor.x][neighbor.y].h;
                  map[neighbor.x][neighbor.y].parent = currentNode;
                        map[neighbor.x][neighbor.y].g = gscore;
                                        // console.log(neighbor);

                    }
            }                

          }
          return [];
          }
   /*   function drawpath(map){
          
          for(var i=0; i<=map.length; i++)
              {
         // if(map[x][y].type==0)
          var ctx = canvas.getContext("2d");

          ctx.fillStyle = "rgb(175,238,238)";
          ctx.fillRect (x*32, y*32, 32, 32);      
        }
      }*/
      
      function searchnode(map, node)
      {
          for(var i=0; i<=map.length; i++)
              {
                  if(map[i] == node)
                      {
                          return true;
                      }
                  
              }
          return false;
          
      }
      

                
    
  </script>
 </head>
 <body>
     <p onclick="draw()">Kliknij!</p>

   <canvas id="canvas" width="320" height="320">
</canvas>
 </body>
</html>